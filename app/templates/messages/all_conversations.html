{% extends "base.html" %}
{% import "_macros.html" as macros %}

{% block title %}Conversations{% endblock %}

{% block page_content %}
<h1>Conversations</h1>
<ul class="messages">
    {% for conversation in conversations %}
    {% set interlocutor = conversation.initiator if conversation.initiator != current_user else conversation.participant%}
    
    {% if conversation.subject %}
    {% set title = conversation.subject %}
    {% endif %}
    {% if conversation.offer_id %}
    {% set title = conversation.offer.title %}
    {% endif %}

    <li class="message">
        <div class="message-thumbnail">
            <a href="{{ url_for('user.user', username=interlocutor.username) }}">
                <img class="img-rounded profile-thumbnail" src="{{ interlocutor.gravatar(size=60) }}">
            </a>
        </div>
        <div class="message-content">
            <div class="message-title"><a href="{{ url_for('messages.single_conversation', id=conversation.id) }}">
                    {{ title }}
                </a></div>
            <div class="message-date">{{ moment(conversation.latest_message.timestamp).fromNow() }}</div>
            <div class="message-body">{{ conversation.latest_message.body | safe | truncate(50, end='â€¦') }}</div>
            <div class="message-author">
                <p>Posted by: <a href="{{ url_for('user.user', username=interlocutor.username) }}">
                        {{ interlocutor.username }}
                    </a></p>
            </div>
        </div>
    </li>
    {% endfor %}
</ul>

{% if pagination %}
<div class="pagination">
    {{ macros.pagination_widget(pagination, '.all_conversations') }}
</div>
{% endif %}
{% endblock %}
